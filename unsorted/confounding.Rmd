---
title: "Confounding effect on joined rcoal trees"
author: "Xavier Didelot"
date: '`r Sys.Date()`'
output:
  html_document: default
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{Confounding effect on joined rcoal trees}
  %\usepackage[utf8]{inputenc}
---

First we generate a dated tree with root in 2000 and three equally related clades.
Each clade is sampled 30 times at a single timepoint. 
The first clade is sampled in 2010, the second one in 2010.1 and the third one in 2010.2.
This is more or less equivalent to Fig 1d of Murray2016.
One difference is that we consider the root known exactly, to show that the problem does not come from misidentification
of the root.
Another difference is that instead of having the three clades exactly equally related we introduce a branch of length 
$s=2$ years, again to show that this is not the cause of the problem.

```{r}
library(DiagnoDating,quietly=T)
set.seed(5)#cherry-picked a nice example
t1=rcoal(30,1:30)
s=2
h1=dist.nodes(t1)[1,Ntip(t1)+1]
t1$root.edge=10-h1-s
t2=rcoal(30,31:60)
h2=dist.nodes(t2)[1,Ntip(t2)+1]
t2$root.edge=10.1-h2-s
t3=rcoal(30,61:90)
h3=dist.nodes(t3)[1,Ntip(t3)+1]
t3$root.edge=10.2-h3
dt=bind.tree(t1,t2,position=t1$root.edge)
dt$root.edge=s
dt=bind.tree(dt,t3,position=dt$root.edge)
dt$root.time=2000
dates=unname(dist.nodes(dt)[Ntip(dt)+1,1:Ntip(dt)])+dt$root.time
plot(dt,show.tip.label=F)
axisPhylo(1,backward = F)
```

Next we generate a phylogenetic tree using a Poisson(10) mutation model:
```{r}
tree=simobsphy(dt,mu=10,model='poisson')
plot(tree,show.tip.label = F)
axisPhylo(1,backward=F)
```

Root-to-tip regression:
```{r}
r=roottotip(tree,dates)
```

Run all dating analysis methods:
```{r}
for (a in 1:5) {
  r=runDating(tree,dates,algo=a)
  plot(r,show.tip.label=F)
  print(r)
  validate(r)
}
```

