library(ValidateDating,quietly=T)
library(phangorn)
rm(list=ls())
source('fig_label.R')
set.seed(1)
dates=runif(100,2010,2020)
dt=simcoaltree(dates,alpha=1)

tree=simobsphy(dt,mu=10,sigma=5,model='arc')

pdf('exampleS1.pdf',12,8)
roottotip(initRoot(tree,dates),dates)
dev.off()
system('open exampleS1.pdf')

tree=unroot(midpoint(tree))
r0=resDating(dt,tree,rate=10,model = 'poisson')
r=runDating(tree,dates,algo='BactDating',model='poisson',showProgress=T)
r2=runDating(tree,dates,algo='BactDating',model='arc',showProgress=T)

pdf('example.pdf',6,10)
par(mfrow=c(3,2),mar=c(4,4,2,2))
plot(dt,show.tip.label = F)
fig_label('A',cex=2)
axisPhylo(1,backward = F)
plotProbBranches(r0,sub=1,minProb=1e-3)
fig_label('B',cex=2)
plotResid(r,3,main='',xlim=c(-4,4),xlab='Residuals',ylim=c(0,0.4),breaks=seq(-10,10,0.5))
fig_label('C',cex=2)
plotResid(r,4,main='',xlim=c(-3,3),ylim=c(-4,4))
fig_label('D',cex=2)
plotResid(r2,3,main='',xlim=c(-4,4),xlab='Residuals',ylim=c(0,0.4),breaks=seq(-10,10,0.5))
fig_label('E',cex=2)
plotResid(r2,4,main='',xlim=c(-3,3),ylim=c(-4,4))
fig_label('F',cex=2)
dev.off()
system('open example.pdf')

class(r)<-'resBactDating';print(r)
class(r2)<-'resBactDating';print(r2)
