library(ValidateDating,quietly=T)
library(phangorn)
rm(list=ls())
source('fig_label.R')
set.seed(4)
dates=runif(200,2000,2020)
dt=simcoaltree(dates,alpha=10)

tree=simobsphy(dt,mu=10,model='poisson')
tree=unroot(midpoint(tree))

r=runDating(tree,dates,algo='treedater')
v=validate(r,resampling=2)

pdf('exampleML.pdf',6,10)
par(mfrow=c(3,2),mar=c(4,4,2,2))
plot(dt,show.tip.label = F)
fig_label('A',cex=2)
axisPhylo(1,backward = F)
plotProbBranches(r,sub=1,minProb=1e-3)
fig_label('B',cex=2)
plotResid(r,3,main='',xlim=c(-4,4),xlab='Residuals',ylim=c(0,0.5),breaks=seq(-10,10,0.5))
fig_label('C',cex=2)
plotResid(r,4,main='',xlim=c(-3,3),ylim=c(-4,4))
fig_label('D',cex=2)
plotResid(v$last,3,main='',xlim=c(-4,4),xlab='Residuals',ylim=c(0,0.5),breaks=seq(-10,10,0.5))
fig_label('E',cex=2)
plotResid(v$last,4,main='',xlim=c(-3,3),ylim=c(-4,4))
fig_label('F',cex=2)
dev.off()
system('open exampleML.pdf')

testResid(r)
print(v)
plot(v)
